<%= widget_div do %>
  <a href="#" id="we-button" class="<%= @button_class %>" onclick="<%= trigger_event(:button_press) %>; return false;"
     onmousedown="set_pressed()" onmouseup="set_released()" onmouseout="set_released()"></a>
  <div class="clicks-set-info">
    <%= I18n.t('social_button.i_commit_to') %> <span><%= @button_click_set %></span> <%= I18n.t('social_button.clicks_a_day') %>. <a href="#" onclick="show_form(); return false;"><%= I18n.t('social_button.change') %></a>
  </div>
  <div class="clicks-set-form" style="display:none;">
    <%= form_for @user, :as => :user, :url => url_for_event(:button_clicks_edit), :remote => true do |f| -%>
      <%= f.text_field :button_click_set, :style => 'width:20px;', :value => @button_click_set %>
      <%= f.submit I18n.t('kabtv.admin.submit'), :style => '', :class => 'button-small-main', :disable_with => I18n.t('kabtv.admin.submitting') %>
      <a href="#" onclick="hide_form(); return false;"><%= I18n.t('social_button.cancel') %></a>
    <% end %>    
  </div>
  <div>
    <% if current_user.is_admin? || current_user.is_reports? %>
      <%= link_to I18n.t('social_button.generate_csv_report'), generate_report_admin_basic_reports_url %>
    <% end %>
  </div>
  <div>
    <center>
      <img id="we-clicks-chart" src="<%= @today_clicks_src %>"
        title="<%= I18n.t('social_button.we_clicks_for_today', :clicks => @today_clicks, :total => @today_total) %>"/><br/>
      <span id="we-clicks-chart-span">
        <%= I18n.t('social_button.we_clicks_for_today', :clicks => @today_clicks, :total => @today_total) %>
      </span>
    </center>
  </div>
  <br/>
  <br/>
  
  <script type="text/javascript">
    function refresh_clicks_chart(clicks, total)
    {
      $('#we-clicks-chart').attr("src",
        'https://chart.googleapis.com/chart?'+
        'cht=p3&'+
        'chs=200x100&'+
        'chd=t:'+clicks+','+(total-clicks)+'&'+
        'chco=19B743,FF0000&'+
        'chdl=We|Me');
    }

    function refresh_chart_text(new_text)
    {
      $('#we-clicks-chart-span').text(new_text);
      $('#we-clicks-chart').attr("title", new_text);
    }
  </script>

  <script type="text/javascript">
    var intervalid = 0;
    var is_we = <%= @status %>;

    <% if @status %>
    intervalid = setTimeout("set_me()", <%= @timeout %>*1000);
    <% end %>
    function set_we(){
      if (intervalid) clearTimeout(intervalid);
      intervalid = setTimeout("set_me()", 30*60*1000);
      $('#we-button').removeClass('me_button').addClass('we_button');
      is_we = true;
    }
    function set_me(){
      $('#we-button').removeClass('we_button').addClass('me_button');
      is_we = false;
    }
    function set_pressed(){
      if (is_we) {
        $('#we-button').removeClass('we_button').addClass('we_button_pressed');
      } else {
        $('#we-button').removeClass('me_button').addClass('me_button_pressed');
      }
    }
    function set_released(){
      if (is_we) {
        $('#we-button').removeClass('we_button_pressed').addClass('we_button');
      } else {
        $('#we-button').removeClass('me_button_pressed').addClass('me_button');
      }
    }
    function show_form(){
      $('.clicks-set-info').hide();
      $('.clicks-set-form').show();
    }
    function hide_form(){
      $('.clicks-set-form').hide();
      $('.clicks-set-info').show();
    }

  </script>

<% end -%>